(function(){
  'use strict';
  const apikey = 'JC86LIY595WFPL8F';
  const symbols = ['SLED4', 'PIBB11', 'NATU3'];
  let main = document.querySelector('.main');

  function getActions(actions) {
    var symbol = actions;
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=' + symbol + '.SA&apikey=' + apikey + '&datatype=json');
    xhr.onreadystatechange = () => {
      if(xhr.readyState === 4){
        if(xhr.status === 200){
          viewActions(JSON.parse(xhr.response));
        }else{
          console.log('deu errado');
        }
      }
    }
    xhr.send();
  }
  function viewActions(result){
    let resultsTimes = result["Time Series (Daily)"];
    let resultMeta = result["Meta Data"];
    let resultsDetails = [];
    for (result in resultsTimes) {
      resultsDetails.push(resultsTimes[result]);
    }
    let latestResult = resultsDetails[0];
    let resultOpen = latestResult["1. open"];
    let resultHight = latestResult["2. high"];
    let resultLow = latestResult["3. low"];
    let resultClose = latestResult["4. close"];
    let resultVolume = latestResult["5. volume"];

    let resultSymbol = resultMeta["2. Symbol"];
    let resultRefreshed = resultMeta["3. Last Refreshed"];
    
    let viewHTML = `<section class="box-actions">
          <div class="box-actions--symbol">Symbol: ${resultSymbol}</div>
          <div class="box-actions--refreshed">Last Refreshed: ${resultRefreshed}</div>
          <ul class=box--actions--values>
            <li>Open: ${resultOpen}</li>
            <li>Hight: ${resultHight}</li>
            <li>Low: ${resultLow}</li>
            <li>Close: ${resultClose}</li>
            <li>Volume: ${resultVolume}</li>
          </ul>
        </div>`;
    
    main.insertAdjacentHTML('beforeend', viewHTML);
    
  }
  function startAjax(){
    symbols.forEach(function(name){
      getActions(name);
    });
  }
  startAjax();
})();
